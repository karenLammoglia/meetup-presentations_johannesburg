<!DOCTYPE html>
<html>
  <head>
    <title>Introduction to R</title>
    <meta charset="utf-8">
    <meta name="author" content="Gemma Dawson and Luis de Sousa" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/default-fonts.css" rel="stylesheet" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Introduction to R
### Gemma Dawson and Luis de Sousa
### 2018/10/01 (updated: 2018-10-01)

---






# slide 1

---

# slide 2





# Importing Data

* R can import data from just about every form imaginable:
* Flat files like plain text and delimited data: .txt, .csv, .tsv
* Data files from proprietary software like MS Excel, SPSS, SAS
* Directly from Databases: MySQL, MS SQL Server, PostgreSQL
* Directly from the Web: APIs, JSON, Webscrape HTML

---

# Importing Data - CSV


```r
library(tidyverse) # load full suite of packages for data analysis
library(babynames) # Full baby name data provided by the SSA
baby_names &lt;- babynames %&gt;% filter(sex == 'F') # import all female baby names
baby_names # preview the data
```

```
## # A tibble: 1,100,858 x 5
##     year sex   name          n   prop
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
##  1  1880 F     Mary       7065 0.0724
##  2  1880 F     Anna       2604 0.0267
##  3  1880 F     Emma       2003 0.0205
##  4  1880 F     Elizabeth  1939 0.0199
##  5  1880 F     Minnie     1746 0.0179
##  6  1880 F     Margaret   1578 0.0162
##  7  1880 F     Ida        1472 0.0151
##  8  1880 F     Alice      1414 0.0145
##  9  1880 F     Bertha     1320 0.0135
## 10  1880 F     Sarah      1288 0.0132
## # ... with 1,100,848 more rows
```

---

# Importing Data - Multiple Excel Sheets to 1 Data Frame


```r
library(readxl) # for reading excel files
path &lt;- "data/gapminder_messy.xlsx"
combined_data &lt;- excel_sheets(path) %&gt;% 
  map_df(~ {
    read_excel(path, sheet = .x, 
               skip = 4, trim_ws = TRUE) %&gt;% 
      mutate(year = as.numeric(.x))
  }) %&gt;% 
  select(country, year, everything())
# show top and bottom 6 rows of data frame
head(combined_data)
```

```
## # A tibble: 6 x 5
##   country      year gdpPercap lifeExp      pop
##   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1 Afghanistan  2007      975.    43.8 31889923
## 2 Albania      2007     5937.    76.4  3600523
## 3 Algeria      2007     6223.    72.3 33333216
## 4 Angola       2007     4797.    42.7 12420476
## 5 Argentina    2007    12779.    75.3 40301927
## 6 Australia    2007    34435.    81.2 20434176
```

```r
tail(combined_data)
```

```
## # A tibble: 6 x 5
##   country             year gdpPercap lifeExp      pop
##   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1 Venezuela           1952     7690.    55.1  5439568
## 2 Vietnam             1952      605.    40.4 26246839
## 3 West Bank and Gaza  1952     1516.    43.2  1030585
## 4 Yemen, Rep.         1952      782.    32.5  4963829
## 5 Zambia              1952     1147.    42.0  2672000
## 6 Zimbabwe            1952      407.    48.5  3080907
```

---

# Importing Data - SPSS

You don't have to pay expensive SPSS licenses to analyse your survey data!


```r
library(haven) # for reading SPSS, SAS, STATA files
survey_data &lt;- read_sav("data/sample_spss_data.sav")
head(survey_data)
```

```
## # A tibble: 6 x 682
##   SubsID responseid respid dCOUNTRY fQ1bGender foQ1aAge_1 dAge  Q2Kids_1
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl+lb&gt; &lt;dbl+lbl&gt;       &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
## 1 21888~        345    347 1        1                  68 3            2
## 2 23586~        185    187 1        1                  51 2            2
## 3 23739~        108    110 1        2                  57 3            2
## 4 25015~        524    526 1        2                  53 2            2
## 5 25405~        349    351 1        2                  25 1            2
## 6 20004~        823    825 1        2                  54 2            1
## # ... with 674 more variables: Q2Kids_2 &lt;dbl&gt;, Q2Kids_3 &lt;dbl&gt;,
## #   dKIDS &lt;dbl+lbl&gt;, Q3 &lt;dbl+lbl&gt;, dNET &lt;dbl+lbl&gt;, fQ2UKRegion &lt;dbl+lbl&gt;,
## #   dRegionUK &lt;dbl+lbl&gt;, fQ2FRRegion &lt;dbl+lbl&gt;, dRegionFR &lt;dbl+lbl&gt;,
## #   fQ2DERegion &lt;dbl+lbl&gt;, dRegionDE &lt;dbl+lbl&gt;, Q2TURRegion &lt;dbl+lbl&gt;,
## #   Q2IncomeUK &lt;dbl+lbl&gt;, dIncomeUK &lt;dbl+lbl&gt;, Q2IncomeFR &lt;dbl+lbl&gt;,
## #   dIncomeFR &lt;dbl+lbl&gt;, Q2IncomeDE &lt;dbl+lbl&gt;, dIncomeDE &lt;dbl+lbl&gt;,
## #   Q2IncomeTUR &lt;dbl+lbl&gt;, dIncomeTUR &lt;dbl+lbl&gt;, Q4_1 &lt;dbl+lbl&gt;,
## #   Q4_2 &lt;dbl+lbl&gt;, Q4_3 &lt;dbl+lbl&gt;, Q4_4 &lt;dbl+lbl&gt;, Q4_5 &lt;dbl+lbl&gt;,
## #   Q4_6 &lt;dbl+lbl&gt;, Q4_99 &lt;dbl+lbl&gt;, Q6_1 &lt;dbl+lbl&gt;, Q6_2 &lt;dbl+lbl&gt;,
## #   Q6_3 &lt;dbl+lbl&gt;, Q6_4 &lt;dbl+lbl&gt;, Q6_5 &lt;dbl+lbl&gt;, Q6_98 &lt;dbl+lbl&gt;,
## #   Q6_99 &lt;dbl+lbl&gt;, dBiscLMAll_1 &lt;dbl+lbl&gt;, dBiscLMAll_2 &lt;dbl+lbl&gt;,
## #   dBiscLMAll_3 &lt;dbl+lbl&gt;, dBiscLMAll_4 &lt;dbl+lbl&gt;,
## #   dBiscLMAll_5 &lt;dbl+lbl&gt;, dBiscLMAll_6 &lt;dbl+lbl&gt;, dTypLMAll_1 &lt;dbl+lbl&gt;,
## #   dTypLMAll_2 &lt;dbl+lbl&gt;, dTypLMAll_3 &lt;dbl+lbl&gt;, dTypLMAll_4 &lt;dbl+lbl&gt;,
## #   dNumber &lt;dbl+lbl&gt;, fQ13_1 &lt;dbl+lbl&gt;, fQ13_2 &lt;dbl+lbl&gt;,
## #   fQ13_3 &lt;dbl+lbl&gt;, fQ13_4 &lt;dbl+lbl&gt;, fQ13_5 &lt;dbl+lbl&gt;,
## #   fQ13_6 &lt;dbl+lbl&gt;, fQ13_7 &lt;dbl+lbl&gt;, fQ13_8 &lt;dbl+lbl&gt;,
## #   fQ13_9 &lt;dbl+lbl&gt;, fQ13_10 &lt;dbl+lbl&gt;, fQ13_11 &lt;dbl+lbl&gt;,
## #   fQ13_12 &lt;dbl+lbl&gt;, fQ13_13 &lt;dbl+lbl&gt;, fQ13_14 &lt;dbl+lbl&gt;,
## #   fQ13_15 &lt;dbl+lbl&gt;, fQ13_16 &lt;dbl+lbl&gt;, fQ13_17 &lt;dbl+lbl&gt;,
## #   fQ13_18 &lt;dbl+lbl&gt;, fQ13_19 &lt;dbl+lbl&gt;, fQ13_20 &lt;dbl+lbl&gt;,
## #   fQ13_21 &lt;dbl+lbl&gt;, fQ13_22 &lt;dbl+lbl&gt;, fQ13_23 &lt;dbl+lbl&gt;,
## #   fQ13_24 &lt;dbl+lbl&gt;, fQ13_25 &lt;dbl+lbl&gt;, fQ13_26 &lt;dbl+lbl&gt;,
## #   fQ13_27 &lt;dbl+lbl&gt;, fQ13_28 &lt;dbl+lbl&gt;, fQ13_29 &lt;dbl+lbl&gt;,
## #   fQ13_30 &lt;dbl+lbl&gt;, fQ13_31 &lt;dbl+lbl&gt;, fQ13_32 &lt;dbl+lbl&gt;,
## #   fQ13_33 &lt;dbl+lbl&gt;, fQ13_34 &lt;dbl+lbl&gt;, fQ13_35 &lt;dbl+lbl&gt;,
## #   fQ13_36 &lt;dbl+lbl&gt;, fQ13_37 &lt;dbl+lbl&gt;, fQ13_38 &lt;dbl+lbl&gt;,
## #   Q25A_1 &lt;dbl+lbl&gt;, Q25A_2 &lt;dbl+lbl&gt;, Q25A_3 &lt;dbl+lbl&gt;,
## #   Q25A_4 &lt;dbl+lbl&gt;, Q25A_5 &lt;dbl+lbl&gt;, Q25A_6 &lt;dbl+lbl&gt;,
## #   Q25A_7 &lt;dbl+lbl&gt;, Q25A_8 &lt;dbl+lbl&gt;, Q25A_9 &lt;dbl+lbl&gt;,
## #   Q25A_10 &lt;dbl+lbl&gt;, Q25A_11 &lt;dbl+lbl&gt;, Q25A_12 &lt;dbl+lbl&gt;,
## #   Q25A_13 &lt;dbl+lbl&gt;, Q25A_14 &lt;dbl+lbl&gt;, Q25A_15 &lt;dbl+lbl&gt;,
## #   Q25A_16 &lt;dbl+lbl&gt;, Q25A_95 &lt;dbl+lbl&gt;, ...
```

```r
# convert spss label codes into labels
labelled_survey_data &lt;- as_factor(survey_data)
head(labelled_survey_data)
```

```
## # A tibble: 6 x 682
##   SubsID responseid respid dCOUNTRY fQ1bGender foQ1aAge_1 dAge  Q2Kids_1
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;    &lt;fct&gt;           &lt;dbl&gt; &lt;fct&gt;    &lt;dbl&gt;
## 1 21888~        345    347 UK       Male               68 55+          2
## 2 23586~        185    187 UK       Male               51 35-54        2
## 3 23739~        108    110 UK       Female             57 55+          2
## 4 25015~        524    526 UK       Female             53 35-54        2
## 5 25405~        349    351 UK       Female             25 16-34        2
## 6 20004~        823    825 UK       Female             54 35-54        1
## # ... with 674 more variables: Q2Kids_2 &lt;dbl&gt;, Q2Kids_3 &lt;dbl&gt;,
## #   dKIDS &lt;fct&gt;, Q3 &lt;fct&gt;, dNET &lt;fct&gt;, fQ2UKRegion &lt;fct&gt;, dRegionUK &lt;fct&gt;,
## #   fQ2FRRegion &lt;fct&gt;, dRegionFR &lt;fct&gt;, fQ2DERegion &lt;fct&gt;,
## #   dRegionDE &lt;fct&gt;, Q2TURRegion &lt;fct&gt;, Q2IncomeUK &lt;fct&gt;, dIncomeUK &lt;fct&gt;,
## #   Q2IncomeFR &lt;fct&gt;, dIncomeFR &lt;fct&gt;, Q2IncomeDE &lt;fct&gt;, dIncomeDE &lt;fct&gt;,
## #   Q2IncomeTUR &lt;fct&gt;, dIncomeTUR &lt;fct&gt;, Q4_1 &lt;fct&gt;, Q4_2 &lt;fct&gt;,
## #   Q4_3 &lt;fct&gt;, Q4_4 &lt;fct&gt;, Q4_5 &lt;fct&gt;, Q4_6 &lt;fct&gt;, Q4_99 &lt;fct&gt;,
## #   Q6_1 &lt;fct&gt;, Q6_2 &lt;fct&gt;, Q6_3 &lt;fct&gt;, Q6_4 &lt;fct&gt;, Q6_5 &lt;fct&gt;,
## #   Q6_98 &lt;fct&gt;, Q6_99 &lt;fct&gt;, dBiscLMAll_1 &lt;fct&gt;, dBiscLMAll_2 &lt;fct&gt;,
## #   dBiscLMAll_3 &lt;fct&gt;, dBiscLMAll_4 &lt;fct&gt;, dBiscLMAll_5 &lt;fct&gt;,
## #   dBiscLMAll_6 &lt;fct&gt;, dTypLMAll_1 &lt;fct&gt;, dTypLMAll_2 &lt;fct&gt;,
## #   dTypLMAll_3 &lt;fct&gt;, dTypLMAll_4 &lt;fct&gt;, dNumber &lt;fct&gt;, fQ13_1 &lt;fct&gt;,
## #   fQ13_2 &lt;fct&gt;, fQ13_3 &lt;fct&gt;, fQ13_4 &lt;fct&gt;, fQ13_5 &lt;fct&gt;, fQ13_6 &lt;fct&gt;,
## #   fQ13_7 &lt;fct&gt;, fQ13_8 &lt;fct&gt;, fQ13_9 &lt;fct&gt;, fQ13_10 &lt;fct&gt;,
## #   fQ13_11 &lt;fct&gt;, fQ13_12 &lt;fct&gt;, fQ13_13 &lt;fct&gt;, fQ13_14 &lt;fct&gt;,
## #   fQ13_15 &lt;fct&gt;, fQ13_16 &lt;fct&gt;, fQ13_17 &lt;fct&gt;, fQ13_18 &lt;fct&gt;,
## #   fQ13_19 &lt;fct&gt;, fQ13_20 &lt;fct&gt;, fQ13_21 &lt;fct&gt;, fQ13_22 &lt;fct&gt;,
## #   fQ13_23 &lt;fct&gt;, fQ13_24 &lt;fct&gt;, fQ13_25 &lt;fct&gt;, fQ13_26 &lt;fct&gt;,
## #   fQ13_27 &lt;fct&gt;, fQ13_28 &lt;fct&gt;, fQ13_29 &lt;fct&gt;, fQ13_30 &lt;fct&gt;,
## #   fQ13_31 &lt;fct&gt;, fQ13_32 &lt;fct&gt;, fQ13_33 &lt;fct&gt;, fQ13_34 &lt;fct&gt;,
## #   fQ13_35 &lt;fct&gt;, fQ13_36 &lt;fct&gt;, fQ13_37 &lt;fct&gt;, fQ13_38 &lt;fct&gt;,
## #   Q25A_1 &lt;fct&gt;, Q25A_2 &lt;fct&gt;, Q25A_3 &lt;fct&gt;, Q25A_4 &lt;fct&gt;, Q25A_5 &lt;fct&gt;,
## #   Q25A_6 &lt;fct&gt;, Q25A_7 &lt;fct&gt;, Q25A_8 &lt;fct&gt;, Q25A_9 &lt;fct&gt;, Q25A_10 &lt;fct&gt;,
## #   Q25A_11 &lt;fct&gt;, Q25A_12 &lt;fct&gt;, Q25A_13 &lt;fct&gt;, Q25A_14 &lt;fct&gt;,
## #   Q25A_15 &lt;fct&gt;, Q25A_16 &lt;fct&gt;, Q25A_95 &lt;fct&gt;, ...
```

```r
labelled_survey_data %&gt;% 
count(fQ1bGender, dAge) %&gt;% 
spread(fQ1bGender, n) %&gt;% 
knitr::kable(format = "html")
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; dAge &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Male &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Female &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 16-34 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 510 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 596 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 35-54 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 664 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 612 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; 55+ &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 362 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 480 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---

# Importing Data - Databases


```r
library(DBI) # for connecting to databases
con &lt;- dbConnect(
drv = RMySQL::MySQL(),
dbname = "shinydemo",
host = "shiny-demo.csa7qlmguqrf.us-east-1.rds.amazonaws.com",
username = "guest",
password = "guest"
)
dbListTables(con)
```

```
## [1] "City"            "Country"         "CountryLanguage"
```

```r
cities &lt;- tbl(con, "City")
cities
```

```
## # Source:   table&lt;City&gt; [?? x 5]
## # Database: mysql 10.0.17-MariaDB
## #   [guest@shiny-demo.csa7qlmguqrf.us-east-1.rds.amazonaws.com:/shinydemo]
##       ID Name           CountryCode District      Population
##    &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;
##  1     1 Kabul          AFG         Kabol            1780000
##  2     2 Qandahar       AFG         Qandahar          237500
##  3     3 Herat          AFG         Herat             186800
##  4     4 Mazar-e-Sharif AFG         Balkh             127800
##  5     5 Amsterdam      NLD         Noord-Holland     731200
##  6     6 Rotterdam      NLD         Zuid-Holland      593321
##  7     7 Haag           NLD         Zuid-Holland      440900
##  8     8 Utrecht        NLD         Utrecht           234323
##  9     9 Eindhoven      NLD         Noord-Brabant     201843
## 10    10 Tilburg        NLD         Noord-Brabant     193238
## # ... with more rows
```

---

# Web APIs

* Many R packages make it easy for you to pull publicly available data via an API (application programming interface).
* The code below retrieves data from the UK police database within 1 mile of the coordinates you provide for the latest available month.


```r
library(ukpolice) # R wrapper to the UK Police API
crime_data &lt;- ukp_crime(lat = 51.533802, lng = -0.092715)
head(crime_data)
```

```
## # A tibble: 6 x 12
##   category persistent_id date    lat    long street_id street_name context
##   &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;chr&gt;  
## 1 anti-so~ ""            2018~  51.5 -0.114  960854    On or near~ ""     
## 2 anti-so~ ""            2018~  51.5 -0.0826 961467    On or near~ ""     
## 3 anti-so~ ""            2018~  51.5 -0.0826 961467    On or near~ ""     
## 4 anti-so~ ""            2018~  51.5 -0.0820 968664    On or near~ ""     
## 5 anti-so~ ""            2018~  51.5 -0.101  961239    On or near~ ""     
## 6 anti-so~ ""            2018~  51.5 -0.0938 964580    On or near~ ""     
## # ... with 4 more variables: id &lt;chr&gt;, location_type &lt;chr&gt;,
## #   location_subtype &lt;chr&gt;, outcome_status &lt;chr&gt;
```





# slide 1

---

# slide 2






# ggplot2

* Combine your data wrangling and chart making into one single process no more pasting data from excel into powerpoint to make or change a chart!
* Makes it easy to quickly iterate over different ways of mapping your data to shapes, space and colour
* Programming a chart with code forces you to think about what you are doing and why
* Allows you to create completley unique charts by adding several different 'layers' of data
* Not constrained by the chart types available in other software packages
* Produce publication quality graphics just like...

---

# Data Visulisations

![dataviz](imgs/data-viz.jpg) 

---







# slide 1

---

# slide 2





# Slide 1

---

# Slide 2
    </textarea>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function() {
  var d = document, s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})();</script>

<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
})();
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
